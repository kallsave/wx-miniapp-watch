/*!
 * wx-miniapp-watch.js v0.0.4
 * (c) 2019-2020 kallsave
 * Released under the MIT License.
 */
/*!
 * wx-miniapp-watch.js v0.0.4
 * (c) 2019-2020 kallsave
 * Released under the MIT License.
 */
var t,e;t=this,e=function(){"use strict";const t=Object.prototype.toString;function e(e){return t.call(e).slice(8,-1)}function s(t){return null!==t&&"object"==typeof t}function n(t){return"Object"===e(t)}function i(t){return"Function"===e(t)}function o(t,e,s,n){Object.defineProperty(t,e,{value:s,enumerable:!!n,configurable:!0,writable:!0})}const r=Array.prototype,a=Object.create(r),h=["push","pop","shift","unshift","splice","sort","reverse"];h.forEach(t=>{const e=r[t];o(a,t,(function(){const s=[];Array.prototype.push.apply(s,arguments);const n=e.apply(this,s),i=this.__ob__;let o;switch(t){case"push":case"unshift":o=s;break;case"splice":o=s.slice(2)}return o&&i.observeArray(o),i.dep.notify(),n}))});let l=0;class c{constructor(){this.id=l++,this.subs=[]}addSub(t){this.subs.push(t)}notify(){this.subs.forEach(t=>{t.update()})}depend(){c.target.addDep(this)}removeSub(t){!function(t,e){if(t.length){const s=t.indexOf(e);s>-1&&t.splice(s,1)}}(this.subs,t)}}c.target=null;const p="__proto__"in{};function d(t,e,s,n){const i=Object.getOwnPropertyDescriptor(t,e);if(i&&!1===i.configurable)return;2===arguments.length&&(s=t[e]);const o=new c;let r=!n&&f(s);Object.defineProperty(t,e,{enumerable:!0,configurable:!0,get:()=>(c.target&&(o.depend(),r&&r.dep.depend()),s),set(t){t===s||t!=t&&s!=s||(s=t,r=!n&&f(t),o.notify())}})}class u{constructor(t){if(this.value=t,this.dep=new c,o(t,"__ob__",this),function(t){return"Array"===e(t)}(t)){if(p)t.__proto__=a;else for(let e=0;e<h.length;e++){const s=h[e];o(t,s,a[s])}this.observeArray(t)}else this.walk(t)}walk(t){const e=Object.keys(t);for(let s=0;s<e.length;s++){const n=e[s];d(t,n,t[n])}}observeArray(t){for(let e=0,s=t.length;e<s;e++)f(t[e])}}function f(t){if(t&&"object"==typeof t)return new u(t)}const b=new Set;function g(t){!function t(e,n){let i,o;const r=Array.isArray(e);if(r||s(e)){if(e.__ob__){const t=e.__ob__.dep.id;if(n.has(t))return;n.add(t)}if(r)for(i=e.length;i--;)t(e[i],n);else for(o=Object.keys(e),i=o.length;i--;)t(e[o[i]],n)}}(t,b),b.clear()}class w{constructor(t,e,s,n,i){this.vm=t,this.cb=s,this.deep=n,this.sync=i,this.depMap={},this.deps=[],this.newDeps=[],this.depIds=new Set,this.newDepIds=new Set,this.getter=this.parsePath(e),this.value=this.get()}parsePath(t){if(/[^\w.$]/.test(t))return;const e=t.split(".");return function(t){for(let s=0,n=e.length;s<n;s++){if(!t)return;t=t[e[s]]}return t}}get(){var t;t=this,c.target=t;const e=this.getter.call(this.vm,this.vm);return this.deep&&g(e),c.target=null,this.cleanupDeps(),e}addDep(t){const e=t.id;this.newDepIds.has(e)||(this.newDepIds.add(e),this.newDeps.push(t),this.depIds.has(e)||t.addSub(this))}update(){const t=this.get(),e=this.value;(t!==e||s(t)||this.deep)&&(this.value=t,this.sync?this.cb.call(this.vm,t,e):setTimeout(()=>{this.cb.call(this.vm,t,e)},0))}cleanupDeps(){let t=this.deps.length;for(;t--;){const e=this.deps[t];this.newDepIds.has(e.id)||e.removeSub(this)}let e=this.depIds;this.depIds=this.newDepIds,this.newDepIds=e,this.newDepIds.clear(),e=this.deps,this.deps=this.newDeps,this.newDeps=e,this.newDeps.length=0}}function y(t,e,s,n){return new w(t,e,s,n)}function _(t,e,s){if(n(e)){f(e);for(const o in s){const r=s[o];i(r)?y(e,o,r.bind(t)):n(r)&&i(r.handler)&&(r.immediate&&r.handler(e[o]),y(e,o,r.handler.bind(t),r.deep))}}}function v(t,e,s,{watch:o,globalWatch:r}={watch:"watch",globalWatch:"globalWatch"},a){let h;for(let s=0;s<e.length;s++){const n=e[s];if(t[n]){h=n;break}}if(h&&i(t[h])){const e=t[h];t[h]=function(){if(o){const e=t[o];n(e)&&_(this,this.data,e)}if(r){const e=t[r];if(n(e)){let s;a?s=t.globalData:_(this,s,e),_(this,s,e)}}return e.apply(this,arguments)}}return t}const D=["onLaunch"],m=App;var j={install(){this.installed||(this.installed=!0,App=function(t){t=v(t,D,0,{watch:"watch"}),m(t)})}};const I=["onLoad"],A=Page;var O={install(){this.installed||(this.installed=!0,Page=function(t){t=v(t,I),A(t)})}};const S=["created","attached","ready"],P=Component;var k={install(){this.installed||(this.installed=!0,Component=function(t){t=v(t,S),P(t)})}};const W={install(){this.installed||(this.installed=!0,j.install(),O.install(),k.install())},verson:"0.0.4"};return W.install(),W},"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).WxMiniappWatch=e();